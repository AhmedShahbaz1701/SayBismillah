<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Say Bismillah</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%232e7d32'/%3E%3Cpath d='M 60 25 A 30 30 0 0 1 60 75 A 22 22 0 0 0 60 25' fill='white' transform='translate(10, -10) rotate(135 50 50)'/%3E%3C/svg%3E">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-gradient-1: #f0f9f4;
            --bg-gradient-2: #e8f5e9;
            --btn-gradient-1: #2e7d32;
            --btn-gradient-2: #43a047;
            --btn-hover-1: #388e3c;
            --btn-hover-2: #4caf50;
            --text-primary: #1b5e20;
            --text-secondary: #558b2f;
            --card-bg: rgba(255, 255, 255, 0.7);
            --shadow: rgba(46, 125, 50, 0.15);
        }
        
        body.dark-mode {
            --bg-gradient-1: #1a2f1a;
            --bg-gradient-2: #0d1f0d;
            --btn-gradient-1: #43a047;
            --btn-gradient-2: #66bb6a;
            --btn-hover-1: #4caf50;
            --btn-hover-2: #81c784;
            --text-primary: #a5d6a7;
            --text-secondary: #81c784;
            --card-bg: rgba(30, 50, 30, 0.7);
            --shadow: rgba(0, 0, 0, 0.3);
        }
        
        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, var(--bg-gradient-1) 0%, var(--bg-gradient-2) 100%);
            min-height: 100vh;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }
        
        .header {
            position: fixed;
            top: 0;
            right: 0;
            padding: 1rem;
            display: flex;
            gap: 1rem;
            z-index: 100;
        }
        
        .icon-btn {
            background: var(--card-bg);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: 0 2px 8px var(--shadow);
            transition: all 0.2s ease;
        }
        
        .icon-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 4rem 2rem 2rem;
            text-align: center;
        }
        
        .main-section {
            margin-bottom: 3rem;
        }
        
        .arabic-text {
            font-size: 3rem;
            margin: 2rem 0 1rem;
            color: var(--text-primary);
            font-weight: 600;
            direction: rtl;
        }
        
        .transliteration {
            font-size: 1.2rem;
            color: var(--text-secondary);
            font-style: italic;
            margin-bottom: 0.5rem;
        }
        
        .translation {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }
        
        .bismillah-button {
            background: linear-gradient(135deg, var(--btn-gradient-1) 0%, var(--btn-gradient-2) 100%);
            color: white;
            border: none;
            padding: 2rem 4rem;
            font-size: 1.8rem;
            font-weight: 600;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 
                0 8px 16px var(--shadow),
                0 4px 8px var(--shadow),
                inset 0 -4px 8px rgba(0, 0, 0, 0.2),
                inset 0 2px 4px rgba(255, 255, 255, 0.2);
            transition: all 0.2s ease;
            letter-spacing: 0.5px;
            position: relative;
            transform: translateY(0);
        }
        
        .bismillah-button:hover {
            transform: translateY(-4px);
            box-shadow: 
                0 12px 24px var(--shadow),
                0 6px 12px var(--shadow),
                inset 0 -4px 8px rgba(0, 0, 0, 0.2),
                inset 0 2px 4px rgba(255, 255, 255, 0.3);
            background: linear-gradient(135deg, var(--btn-hover-1) 0%, var(--btn-hover-2) 100%);
        }
        
        .bismillah-button:active {
            transform: translateY(2px);
            box-shadow: 
                0 4px 8px var(--shadow),
                0 2px 4px var(--shadow),
                inset 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .bismillah-button.playing {
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                box-shadow: 
                    0 8px 16px var(--shadow),
                    0 4px 8px var(--shadow),
                    inset 0 -4px 8px rgba(0, 0, 0, 0.2);
            }
            50% {
                box-shadow: 
                    0 12px 32px rgba(46, 125, 50, 0.4),
                    0 6px 16px rgba(46, 125, 50, 0.3),
                    inset 0 -4px 8px rgba(0, 0, 0, 0.2);
            }
        }
        
        .helper-text {
            margin-top: 1rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .counter {
            margin-top: 1.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .expandable {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px var(--shadow);
        }
        
        .expandable-header {
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .expandable-header:hover {
            color: var(--btn-gradient-2);
        }
        
        .expandable-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            text-align: left;
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        .expandable-content.open {
            max-height: 1000px;
            margin-top: 1rem;
        }
        
        .expandable-content h4 {
            color: var(--text-primary);
            margin: 1rem 0 0.5rem;
        }
        
        .expandable-content ul {
            margin: 0.5rem 0 0.5rem 1.5rem;
        }
        
        .footer {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--shadow);
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .share-btn {
            background: var(--card-bg);
            border: 2px solid var(--btn-gradient-1);
            color: var(--text-primary);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin: 1rem 0;
            transition: all 0.2s ease;
        }
        
        .share-btn:hover {
            background: var(--btn-gradient-1);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }
        
        @media (max-width: 600px) {
            .arabic-text {
                font-size: 2rem;
            }
            
            .bismillah-button {
                padding: 1.5rem 3rem;
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <button class="icon-btn" id="shareBtn" title="Share">↗</button>
        <button class="icon-btn" id="darkModeBtn" title="Toggle dark mode">⚫</button>
    </div>
    
    <div class="container">
        <div class="main-section">
            <div class="arabic-text">بِسْمِ ٱللَّٰهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ</div>
            <div class="transliteration">Bismillahir Rahmaanir Raheem</div>
            <div class="translation">In the name of Allah, the Most Gracious, the Most Merciful</div>
            
            <button class="bismillah-button" id="bismillahBtn">Say Bismillah</button>
            <div class="helper-text">Tap to listen</div>
            <div class="counter">Played <span id="playCount">0</span> times</div>
        </div>
        
        <div class="expandable">
            <div class="expandable-header" onclick="toggleSection('significance')">
                <span>Why Say Bismillah?</span>
                <span id="significance-arrow">▼</span>
            </div>
            <div class="expandable-content" id="significance">
                <p>Saying "Bismillah" before any action is a beautiful Islamic practice that invokes Allah's blessings and protection. It reminds us that all our actions begin with His name and by His will.</p>
                
                <h4>When to Say Bismillah</h4>
                <ul>
                    <li>Before eating or drinking</li>
                    <li>Before starting any work or task</li>
                    <li>Before entering your home</li>
                    <li>Before studying or learning</li>
                    <li>Before any journey</li>
                    <li>Before any good deed</li>
                </ul>
            </div>
        </div>
        
        <div class="footer">
            <p>Contact: <a href="mailto:salaam@saybismillah.com" style="color: var(--text-primary);">salaam@saybismillah.com</a></p>
            <p style="margin-top: 0.5rem; font-size: 0.8rem;">May this simple reminder bring barakah to your actions</p>
        </div>
    </div>
    
    <audio id="bismillahAudio" preload="auto">
        <source src="Bismillah.mp3" type="audio/mpeg">
    </audio>
    
    <script>
        const button = document.getElementById('bismillahBtn');
        const audio = document.getElementById('bismillahAudio');
        const playCountEl = document.getElementById('playCount');
        const darkModeBtn = document.getElementById('darkModeBtn');
        const shareBtn = document.getElementById('shareBtn');
        
        let playCount = 0;
        
        // Load play count from server on page load
        async function loadPlayCount() {
            try {
                const response = await fetch('/api/plays/current');
                const data = await response.json();
                playCount = data.count || 0;
                playCountEl.textContent = playCount.toLocaleString();
            } catch (error) {
                console.error('Failed to load play count:', error);
                playCountEl.textContent = '0';
            }
        }
        
        // Initialize - load count from server
        loadPlayCount();
        
        button.addEventListener('click', async () => {
            audio.currentTime = 0;
            audio.play();
            button.classList.add('playing');
            
            // Increment on server and update display
            try {
                const response = await fetch('/api/plays');
                const data = await response.json();
                playCount = data.count;
                playCountEl.textContent = playCount.toLocaleString();
            } catch (error) {
                console.error('Failed to increment play count:', error);
                // Still increment locally as fallback
                playCount++;
                playCountEl.textContent = playCount.toLocaleString();
            }
        });
        
        audio.addEventListener('ended', () => {
            button.classList.remove('playing');
        });
        
        darkModeBtn.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            darkModeBtn.textContent = document.body.classList.contains('dark-mode') ? '⚪' : '⚫';
        });
        
        shareBtn.addEventListener('click', async () => {
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'Say Bismillah',
                        text: 'Start your actions with Bismillah',
                        url: window.location.href
                    });
                } catch (err) {
                    copyToClipboard();
                }
            } else {
                copyToClipboard();
            }
        });
        
        function copyToClipboard() {
            navigator.clipboard.writeText(window.location.href);
            const originalText = shareBtn.textContent;
            shareBtn.textContent = '✓ Copied!';
            setTimeout(() => {
                shareBtn.textContent = originalText;
            }, 2000);
        }
        
        function toggleSection(id) {
            const content = document.getElementById(id);
            const arrow = document.getElementById(id + '-arrow');
            content.classList.toggle('open');
            arrow.textContent = content.classList.contains('open') ? '▲' : '▼';
        }
    </script>
</body>
</html>